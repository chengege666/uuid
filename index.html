<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UUID 生成器 - 纯前端工具</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 900px;
            padding: 40px;
            position: relative;
            overflow: hidden;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.1rem;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 25px;
            color: #856404;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .warning i {
            font-size: 1.2rem;
        }
        
        .controls {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 20px;
            margin-bottom: 25px;
            align-items: end;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        label {
            font-weight: 600;
            color: #444;
            font-size: 1rem;
        }
        
        input[type="number"] {
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #0da271;
        }
        
        .btn-info {
            background: #0ea5e9;
            color: white;
        }
        
        .btn-info:hover {
            background: #0284c7;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result-area {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .result-label {
            font-weight: 600;
            color: #444;
        }
        
        .result-count {
            color: #666;
            font-size: 0.9rem;
        }
        
        .single-result {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 1.1rem;
            background: #f8f9fa;
            cursor: pointer;
            user-select: all;
            transition: border-color 0.3s;
        }
        
        .single-result:hover {
            border-color: #667eea;
        }
        
        .batch-result {
            width: 100%;
            padding: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.95rem;
            background: #f8f9fa;
            resize: vertical;
            min-height: 200px;
            line-height: 1.5;
            white-space: pre;
            overflow-x: auto;
        }
        
        .batch-result:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .info-bar {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: #666;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .spec {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .badge {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .footer {
            margin-top: 20px;
            text-align: center;
            color: #888;
            font-size: 0.85rem;
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-fingerprint"></i> UUID 生成器</h1>
            <p class="subtitle">纯前端 · 符合 RFC 4122 标准 · 无需网络</p>
        </div>
        
        <div class="warning" id="securityWarning" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i>
            <span>当前使用 Math.random() 生成 UUID，安全性较低。建议使用支持 crypto.getRandomValues() 的现代浏览器。</span>
        </div>
        
        <div class="controls">
            <div class="input-group">
                <label for="count"><i class="fas fa-hashtag"></i> 生成数量 (1-1000)</label>
                <input type="number" id="count" min="1" max="1000" value="1">
            </div>
            <div class="buttons">
                <button class="btn btn-primary" id="generateBtn">
                    <i class="fas fa-bolt"></i> 生成 UUID
                </button>
                <button class="btn btn-success" id="copyBtn" disabled>
                    <i class="far fa-copy"></i> 复制全部
                </button>
                <button class="btn btn-info" id="randomCopyBtn" disabled style="display: none;">
                    <i class="fas fa-random"></i> 随机复制一个
                </button>
                <button class="btn btn-danger" id="clearBtn" disabled>
                    <i class="fas fa-trash"></i> 清空
                </button>
            </div>
        </div>
        
        <div class="result-area">
            <div class="result-header">
                <span class="result-label">生成结果</span>
                <span class="result-count" id="resultCount">0 个 UUID</span>
            </div>
            <div id="singleResultContainer" style="display: none;">
                <div class="single-result" id="singleResult" title="点击全选，双击复制"></div>
            </div>
            <textarea class="batch-result" id="batchResult" placeholder="生成的 UUID 将显示在这里..." readonly></textarea>
            
            <div class="action-buttons" id="batchActions" style="display: none;">
                <button class="btn btn-success" id="batchCopyBtn">
                    <i class="far fa-copy"></i> 复制全部
                </button>
                <button class="btn btn-info" id="batchRandomCopyBtn">
                    <i class="fas fa-random"></i> 随机复制一个
                </button>
            </div>
        </div>
        
        <div class="info-bar">
            <div class="spec">
                <span class="badge">v4</span>
                <span>RFC 4122 标准格式</span>
            </div>
            <div class="spec">
                <span class="badge">8-4-4-4-12</span>
                <span>固定格式</span>
            </div>
            <div class="spec">
                <span id="randomMethod">crypto.getRandomValues()</span>
            </div>
        </div>
        
        <div class="footer">
            <p>© 2026 UUID 生成器 | 所有操作均在本地完成，不收集任何数据</p>
        </div>
    </div>
    
    <div class="toast" id="toast"></div>

    <script>
        // 全局变量存储当前生成的UUID数组
        let currentUUIDs = [];
        
        // 检测浏览器是否支持 crypto.getRandomValues
        const hasCrypto = typeof window.crypto !== 'undefined' && 
                         typeof window.crypto.getRandomValues !== 'undefined';
        
        // 显示安全警告（如果不支持 crypto API）
        if (!hasCrypto) {
            document.getElementById('securityWarning').style.display = 'flex';
            document.getElementById('randomMethod').textContent = 'Math.random()';
            document.getElementById('randomMethod').style.color = '#dc2626';
        }
        
        // UUID v4 生成函数（符合 RFC 4122 标准）
        function generateUUIDv4() {
            let randomValues;
            
            if (hasCrypto) {
                // 使用 crypto.getRandomValues（密码学安全的随机数）
                randomValues = new Uint8Array(16);
                window.crypto.getRandomValues(randomValues);
            } else {
                // 降级到 Math.random（较低安全性）
                randomValues = new Uint8Array(16);
                for (let i = 0; i < 16; i++) {
                    randomValues[i] = Math.floor(Math.random() * 256);
                }
            }
            
            // 设置版本位（v4）和变体位
            randomValues[6] = (randomValues[6] & 0x0f) | 0x40; // 版本 4
            randomValues[8] = (randomValues[8] & 0x3f) | 0x80; // 变体 1 (RFC 4122)
            
            // 转换为十六进制字符串
            const hexBytes = Array.from(randomValues)
                .map(b => b.toString(16).padStart(2, '0'));
            
            // 格式化为 8-4-4-4-12
            return [
                hexBytes.slice(0, 4).join(''),
                hexBytes.slice(4, 6).join(''),
                hexBytes.slice(6, 8).join(''),
                hexBytes.slice(8, 10).join(''),
                hexBytes.slice(10, 16).join('')
            ].join('-');
        }
        
        // 批量生成 UUID
        function generateUUIDs(count) {
            const uuids = [];
            for (let i = 0; i < count; i++) {
                uuids.push(generateUUIDv4());
            }
            return uuids;
        }
        
        // 显示结果
        function displayResults(uuids) {
            const count = uuids.length;
            const resultCountElement = document.getElementById('resultCount');
            const singleResultContainer = document.getElementById('singleResultContainer');
            const singleResultElement = document.getElementById('singleResult');
            const batchResultElement = document.getElementById('batchResult');
            const copyBtn = document.getElementById('copyBtn');
            const clearBtn = document.getElementById('clearBtn');
            const randomCopyBtn = document.getElementById('randomCopyBtn');
            const batchActions = document.getElementById('batchActions');
            const batchCopyBtn = document.getElementById('batchCopyBtn');
            const batchRandomCopyBtn = document.getElementById('batchRandomCopyBtn');
            
            // 保存当前UUID数组
            currentUUIDs = uuids;
            
            // 更新计数
            resultCountElement.textContent = `${count} 个 UUID`;
            
            if (count === 1) {
                // 单个 UUID：显示在输入框中
                singleResultContainer.style.display = 'block';
                batchResultElement.style.display = 'none';
                batchActions.style.display = 'none';
                singleResultElement.textContent = uuids[0];
                
                // 启用复制按钮，禁用随机复制按钮
                copyBtn.disabled = false;
                randomCopyBtn.style.display = 'none';
            } else {
                // 批量 UUID：显示在文本区域中
                singleResultContainer.style.display = 'none';
                batchResultElement.style.display = 'block';
                batchActions.style.display = 'flex';
                batchResultElement.value = uuids.join('\n');
                
                // 禁用顶部复制按钮，显示随机复制按钮
                copyBtn.disabled = true;
                randomCopyBtn.style.display = 'flex';
            }
            
            // 启用清空按钮
            clearBtn.disabled = false;
        }
        
        // 复制全部到剪贴板
        async function copyToClipboard() {
            const singleResultElement = document.getElementById('singleResult');
            const batchResultElement = document.getElementById('batchResult');
            let textToCopy = '';
            
            if (document.getElementById('singleResultContainer').style.display !== 'none') {
                textToCopy = singleResultElement.textContent;
            } else {
                textToCopy = batchResultElement.value;
            }
            
            try {
                await navigator.clipboard.writeText(textToCopy);
                showToast('UUID 已复制到剪贴板！');
            } catch (err) {
                // 降级方案：使用 document.execCommand
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showToast('UUID 已复制到剪贴板！');
                } catch (err2) {
                    showToast('复制失败，请手动选择并复制', 'error');
                }
                document.body.removeChild(textArea);
            }
        }
        
        // 随机复制一个UUID
        async function copyRandomUUID() {
            if (currentUUIDs.length === 0) {
                showToast('没有可用的UUID', 'error');
                return;
            }
            
            // 从当前UUID数组中随机选择一个
            const randomIndex = Math.floor(Math.random() * currentUUIDs.length);
            const randomUUID = currentUUIDs[randomIndex];
            
            try {
                await navigator.clipboard.writeText(randomUUID);
                showToast(`已随机复制第 ${randomIndex + 1} 个UUID: ${randomUUID}`);
            } catch (err) {
                // 降级方案：使用 document.execCommand
                const textArea = document.createElement('textarea');
                textArea.value = randomUUID;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showToast(`已随机复制第 ${randomIndex + 1} 个UUID: ${randomUUID}`);
                } catch (err2) {
                    showToast('复制失败，请手动选择并复制', 'error');
                }
                document.body.removeChild(textArea);
            }
        }
        
        // 清空结果
        function clearResults() {
            const singleResultElement = document.getElementById('singleResult');
            const batchResultElement = document.getElementById('batchResult');
            const resultCountElement = document.getElementById('resultCount');
            const copyBtn = document.getElementById('copyBtn');
            const clearBtn = document.getElementById('clearBtn');
            const randomCopyBtn = document.getElementById('randomCopyBtn');
            const batchActions = document.getElementById('batchActions');
            
            // 清空显示
            singleResultElement.textContent = '';
            batchResultElement.value = '';
            resultCountElement.textContent = '0 个 UUID';
            document.getElementById('singleResultContainer').style.display = 'none';
            batchResultElement.style.display = 'block';
            batchActions.style.display = 'none';
            
            // 清空存储的UUID数组
            currentUUIDs = [];
            
            // 禁用按钮
            copyBtn.disabled = true;
            clearBtn.disabled = true;
            randomCopyBtn.style.display = 'none';
        }
        
        // 显示提示消息
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.background = type === 'error' ? '#ef4444' : '#10b981';
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // 自动选择单个 UUID
        function selectSingleResult() {
            const element = document.getElementById('singleResult');
            const selection = window.getSelection();
            const range = document.createRange();
            
            range.selectNodeContents(element);
            selection.removeAllRanges();
            selection.addRange(range);
        }
        
        // 双击复制单个 UUID
        function copySingleResultOnDoubleClick() {
            const element = document.getElementById('singleResult');
            if (element.textContent) {
                navigator.clipboard.writeText(element.textContent)
                    .then(() => showToast('UUID 已复制到剪贴板！'))
                    .catch(err => {
                        // 降级方案
                        const textArea = document.createElement('textarea');
                        textArea.value = element.textContent;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        showToast('UUID 已复制到剪贴板！');
                    });
            }
        }
        
        // 事件监听器
        document.addEventListener('DOMContentLoaded', function() {
            const generateBtn = document.getElementById('generateBtn');
            const copyBtn = document.getElementById('copyBtn');
            const randomCopyBtn = document.getElementById('randomCopyBtn');
            const clearBtn = document.getElementById('clearBtn');
            const countInput = document.getElementById('count');
            const singleResultElement = document.getElementById('singleResult');
            const batchCopyBtn = document.getElementById('batchCopyBtn');
            const batchRandomCopyBtn = document.getElementById('batchRandomCopyBtn');
            
            // 生成按钮点击事件
            generateBtn.addEventListener('click', function() {
                let count = parseInt(countInput.value) || 1;
                
                // 验证输入范围
                if (count < 1) count = 1;
                if (count > 1000) {
                    count = 1000;
                    countInput.value = 1000;
                    showToast('生成数量已限制为最大值 1000', 'error');
                }
                
                // 生成并显示 UUID
                const uuids = generateUUIDs(count);
                displayResults(uuids);
            });
            
            // 顶部复制按钮点击事件
            copyBtn.addEventListener('click', copyToClipboard);
            
            // 顶部随机复制按钮点击事件
            randomCopyBtn.addEventListener('click', copyRandomUUID);
            
            // 清空按钮点击事件
            clearBtn.addEventListener('click', clearResults);
            
            // 批量复制按钮点击事件
            batchCopyBtn.addEventListener('click', copyToClipboard);
            
            // 批量随机复制按钮点击事件
            batchRandomCopyBtn.addEventListener('click', copyRandomUUID);
            
            // 输入框变化事件
            countInput.addEventListener('change', function() {
                let value = parseInt(this.value) || 1;
                if (value < 1) this.value = 1;
                if (value > 1000) this.value = 1000;
            });
            
            // 单个结果点击事件
            singleResultElement.addEventListener('click', selectSingleResult);
            singleResultElement.addEventListener('dblclick', copySingleResultOnDoubleClick);
            
            // 回车键快速生成
            countInput.addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    generateBtn.click();
                }
            });
            
            // 初始生成一个 UUID
            generateBtn.click();
        });
        
        // 测试用例 - 验证 UUID 生成功能
        function testUUIDGeneration() {
            console.log("=== UUID 生成器测试 ===");
            
            // 测试单个 UUID
            const singleUUID = generateUUIDv4();
            console.log("单个 UUID:", singleUUID);
            console.log("格式验证:", /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(singleUUID));
            
            // 测试批量生成
            const batchUUIDs = generateUUIDs(5);
            console.log("批量生成 5 个 UUID:");
            batchUUIDs.forEach((uuid, index) => {
                console.log(`  ${index + 1}: ${uuid}`);
            });
            
            // 测试版本位和变体位
            const testUUID = generateUUIDv4();
            const parts = testUUID.split('-');
            console.log("版本位验证 (第3部分的第一个字符应为 '4'):", parts[2][0] === '4');
            console.log("变体位验证 (第4部分的第一个字符应为 '8','9','a'或'b'):", /^[89ab]/i.test(parts[3]));
            
            console.log("=== 测试完成 ===");
        }
        
        // 页面加载完成后运行测试
        window.addEventListener('load', testUUIDGeneration);
    </script>
</body>
</html>
